% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dp_hist.R
\name{dp_hist}
\alias{dp_hist}
\title{Differentially Private 2D Histogram on PCA Scores}
\usage{
dp_hist(
  X,
  center = TRUE,
  scale. = FALSE,
  dp_pca_flag = FALSE,
  cpp.option = TRUE,
  axes = c(1, 2),
  eps_total,
  delta_total,
  eps_ratio = NULL,
  delta_ratio = NULL,
  inflate = 0.1,
  q_frame = NULL,
  m_x = NULL,
  m_y = NULL,
  bin_method = c("J", "W"),
  mechanism = c("all", "none", "add", "sparse"),
  sampling = FALSE
)
}
\arguments{
\item{X}{A numeric matrix or an object coercible to a matrix with
\eqn{n} rows (observations) and \eqn{p} columns (variables). PCA is
performed on \code{X} and the first two PCs are used for binning.}

\item{center}{Logical; should the variables be centered before PCA?
Passed to \code{scale()}.}

\item{scale.}{Logical; should the variables be scaled to unit variance?
Passed to \code{scale()}.}

\item{dp_pca_flag}{Logical; if \code{TRUE}, apply differentially private PCA
using \code{dp_pca()} with part of the total privacy budget
\code{eps_total}, \code{delta_total}. If \code{FALSE}, use non-DP PCA.}

\item{cpp.option}{Logical; if \code{TRUE}, allow C++ implementations inside
DP mechanisms (e.g., \code{mech_tau_sph()}) when available.}

\item{axes}{Integer vector indicating which principal components to return
(e.g., \code{c(1, 2)} for the first two PCs). The maximum index in
\code{axes} must not exceed the number of variables \code{p}.}

\item{eps_total}{Total privacy budget \eqn{\varepsilon_{\text{total}}} to be
split among DP-PCA (optional), DP frame (\code{dp_frame()}), and DP
histogram mechanisms.}

\item{delta_total}{Total privacy parameter \eqn{\delta_{\text{total}}} to be
split among the same components.}

\item{eps_ratio}{Optional numeric vector specifying the relative allocation
of \code{eps_total}. If \code{dp_pca_flag = TRUE}, this must have length 3
and corresponds to \code{(PCA, q, hist)}. If \code{dp_pca_flag = FALSE},
this must have length 2 and corresponds to \code{(q, hist)}. The vector is
normalized to sum to 1. If \code{NULL}, equal weights are used.}

\item{delta_ratio}{Optional numeric vector specifying the relative allocation
of \code{delta_total}, with the same conventions as \code{eps_ratio}. The
vector is normalized to sum to 1. If \code{NULL}, equal weights are used.}

\item{inflate}{Non-negative numeric value controlling how much to enlarge the
DP frame relative to the DP min--max interval obtained from
\code{dp_frame()}. A value of \code{inflate = 0.10} enlarges the interval
by 10\\%.}

\item{q_frame}{Optional symmetric quantile level in \eqn{(0,1)} passed to
\code{dp_frame()}. If \code{NULL}, extreme order statistics
\eqn{1/n} and \eqn{(n-1)/n} are used.}

\item{m_x}{Optional integer specifying the number of bins along the first PC
axis. If \code{NULL}, it is chosen via \code{number_bins()}.}

\item{m_y}{Optional integer specifying the number of bins along the second PC
axis. If \code{NULL}, it is chosen via \code{number_bins()}.}

\item{bin_method}{Character string specifying the heuristic used by
\code{number_bins()} when \code{m_x} and/or \code{m_y} are not supplied.
One of \code{"J"} (Jing) or \code{"W"} (Wasserman).}

\item{mechanism}{Character string indicating which histogram mechanism(s) to
compute:
\itemize{
\item \code{"none"}: non-DP empirical histogram on PCA scores.
\item \code{"add"}: Gaussian additive noise on bin counts with
subsequent normalization.
\item \code{"sparse"}: Laplace noise with thresholding (sparse DP
histogram).
\item \code{"all"}: compute all three versions.
}}

\item{sampling}{Logical; if \code{TRUE}, additionally generate synthetic
samples from each (available) histogram version using
\code{sample_from_hist()} with \code{k = n}.}
}
\value{
A list with components:
\itemize{
\item \code{pca}: A list containing
\itemize{
\item \code{X_pca}: \eqn{n \times 2} matrix of PCA scores.
\item \code{loadings}: loading matrix from \code{dp_pca()}.
\item \code{eigvals}: selected eigenvalues.
\item \code{dp}: logical flag indicating whether DP-PCA was used.
}
\item \code{frame}: A list with \code{xlim} and \code{ylim} giving the DP
plotting limits.
\item \code{breaks}: A list with \code{x} and \code{y} break vectors.
\item \code{counts}: Vector of empirical bin counts.
\item \code{prob}: Vector of empirical bin probabilities \code{p_hat}.
\item \code{mechanism}: The mechanism argument used.
\item \code{eps}: A list with \code{total}, \code{pca}, \code{q},
and \code{hist} components indicating how \code{eps_total} was split.
\item \code{delta}: A list with \code{total}, \code{pca}, \code{q},
and \code{hist} components indicating how \code{delta_total} was split.
\item \code{none}: If requested (via \code{mechanism}), a list with fields
\code{prob}, \code{coord}, and optionally \code{sample} for the empirical
histogram.
\item \code{add}: If requested, a list with fields \code{prob}, \code{coord},
and optionally \code{sample} for the Gaussian-perturbed DP histogram.
\item \code{sparse}: If requested, a list with fields \code{prob},
\code{coord}, and optionally \code{sample} for the sparse DP histogram.
}
}
\description{
Constructs a (optionally differentially private) 2D histogram on the first
two principal component scores of the input data. The function supports
differentially private PCA, differentially private frame construction, and
two types of DP histogram mechanisms (Gaussian additive noise and sparse
Laplace thresholding), as well as the non-DP empirical histogram.
}
\details{
The function proceeds in several steps:
\enumerate{
\item \strong{Privacy budget split}: The total budget
\code{(eps_total, delta_total)} is split into components for DP-PCA
(optional), DP frame, and DP histogram according to
\code{eps_ratio} and \code{delta_ratio}.
\item \strong{(DP) PCA}: The data \code{X} are projected to the first two
principal components using \code{dp_pca()} with or without privacy,
depending on \code{dp_pca_flag}.
\item \strong{DP frame}: A differentially private square plotting frame
\code{(xlim, ylim)} is constructed on the 2D scores using
\code{dp_frame()}.
\item \strong{Bin selection}: If \code{m_x} and/or \code{m_y} are missing,
a recommended number of bins per axis is computed by
\code{number_bins()}.
\item \strong{Empirical histogram}: Counts and empirical probabilities
\code{p_hat} are computed on the regular grid induced by
\code{x_breaks} and \code{y_breaks}.
\item \strong{DP histogram mechanisms}:
\itemize{
\item \code{"none"}: returns the empirical probabilities.
\item \code{"add"}: adds Gaussian noise to the bin counts, clips to
nonnegative values, and renormalizes.
\item \code{"sparse"}: adds Laplace noise to the empirical bin
probabilities and applies a data-dependent threshold to obtain
a sparse DP histogram.
}
\item \strong{Optional sampling}: If \code{sampling = TRUE}, each available
histogram version is converted into synthetic samples via
\code{sample_from_hist()}.
}
}
\seealso{
\code{\link{dp_pca}},
\code{\link{dp_frame}},
\code{\link{number_bins}},
\code{\link{sample_from_hist}},
\code{\link{dp_score_plot}},
\code{\link{dp_score_plot_group}}
}
