% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dp_score_plot_group.R
\name{dp_score_plot_group}
\alias{dp_score_plot_group}
\title{Group-wise DP PCA Score Plots with 2D Histograms}
\usage{
dp_score_plot_group(
  X,
  G,
  center = TRUE,
  scale. = FALSE,
  dp_pca_flag = FALSE,
  cpp.option = FALSE,
  axes = c(1, 2),
  eps_total,
  delta_total,
  eps_ratio = NULL,
  delta_ratio = NULL,
  inflate = 0.2,
  q_frame = NULL,
  m_x = NULL,
  m_y = NULL,
  bin_method = c("J", "W", "none"),
  mechanism = c("all", "none", "add", "sparse"),
  sampling = FALSE
)
}
\arguments{
\item{X}{A numeric matrix or data frame with \eqn{n} rows (observations) and
\eqn{p} columns (variables and possibly a group label column). PCA is
performed on the feature columns, and the first two PCs are used for
plotting.}

\item{G}{Group labels. Either
\itemize{
\item a vector of length \code{n} giving the group for each row of
\code{X}, or
\item a single character string giving the name of a column in \code{X}
that contains the group labels.
}}

\item{center}{Logical; should the variables be centered before PCA?
Passed to \code{scale()}.}

\item{scale.}{Logical; should the variables be scaled to unit variance?
Passed to \code{scale()}.}

\item{dp_pca_flag}{Logical; if \code{TRUE}, apply differentially private PCA
using \code{dp_pca()} with part of the total privacy budget
\code{eps_total}, \code{delta_total}. If \code{FALSE}, use non-DP PCA.}

\item{cpp.option}{Logical; if \code{TRUE}, allow C++ implementations inside
DP mechanisms (e.g., \code{mech_tau_sph()}) when available.}

\item{axes}{Integer vector indicating which principal components to return
(e.g., \code{c(1, 2)} for the first two PCs). The maximum index in
\code{axes} must not exceed the number of variables \code{p}.}

\item{eps_total}{Total privacy budget \eqn{\varepsilon_{\text{total}}} to be
split among DP-PCA (optional), DP frame (\code{dp_frame()}), and group-wise
DP histograms (inside \code{dp_hist_group()}).}

\item{delta_total}{Total privacy parameter \eqn{\delta_{\text{total}}} to be
split among the same components.}

\item{eps_ratio}{Optional numeric vector specifying the relative allocation
of \code{eps_total}. If \code{dp_pca_flag = TRUE}, this must have length 3
and corresponds to \code{(PCA, q, hist)}. If \code{dp_pca_flag = FALSE},
this must have length 2 and corresponds to \code{(q, hist)}. The vector is
normalized to sum to 1. If \code{NULL}, equal weights are used.}

\item{delta_ratio}{Optional numeric vector specifying the relative allocation
of \code{delta_total}, with the same conventions as \code{eps_ratio}. The
vector is normalized to sum to 1. If \code{NULL}, equal weights are used.}

\item{inflate}{Non-negative numeric value controlling how much to enlarge the
DP frame relative to the DP min--max interval obtained from
\code{dp_frame()}. A value of \code{inflate = 0.20} enlarges the interval
by 20\\%.}

\item{q_frame}{Optional symmetric quantile level in \eqn{(0,1)} passed to
\code{dp_frame()} via \code{dp_hist_group()}. If \code{NULL}, extreme order
statistics \eqn{1/n} and \eqn{(n-1)/n} are used.}

\item{m_x}{Optional integer specifying the number of bins along the first PC
axis. If \code{NULL}, it is chosen via \code{number_bins()} based on the
pooled PCA scores.}

\item{m_y}{Optional integer specifying the number of bins along the second PC
axis. If \code{NULL}, it is chosen via \code{number_bins()}.}

\item{bin_method}{Character string specifying the heuristic used by
\code{number_bins()} when \code{m_x} and/or \code{m_y} are not supplied.
One of \code{"J"} (Jing) or \code{"W"} (Wasserman).}

\item{mechanism}{Character string indicating which histogram mechanism(s) to
compute and display for each group:
\itemize{
\item \code{"none"}: (not used for group DP; empirical group histograms
are derived from counts).
\item \code{"add"}: Gaussian additive-noise DP histograms per group.
\item \code{"sparse"}: sparse Laplace-thresholded DP histograms per group.
\item \code{"all"}: compute and, if possible, display both
\code{"add"} and \code{"sparse"}.
}}

\item{sampling}{Logical; if \code{TRUE}, additionally generate and display
synthetic samples from each group's DP histogram(s) using
\code{sample_from_hist()} with \code{k = n_g}, where \code{n_g} is the
group size.}
}
\value{
A list equal to the output of \code{dp_hist_group()}, augmented with:
\itemize{
\item \code{plot}: a list of ggplot2/patchwork objects, including
\itemize{
\item \code{all}: the main combined layout showing the group-colored
scatter plot and group-wise histograms (and, optionally, samples).
\item \code{none_hist}, \code{add_hist}, \code{sparse_hist}:
each is a list whose first element \code{all} is a patchwork
layout, followed by per-group histogram panels.
\item \code{none_sampling}, \code{add_sampling},
\code{sparse_sampling}: analogous lists for sampling-based
visualizations (if \code{sampling = TRUE}).
}
\item \code{group_colors}: a named character vector mapping group levels
to the colors used in the plots.
}
}
\description{
Creates group-wise PCA score plots combined with (optionally differentially
private) 2D histograms based on the first two principal components. Each
group shares a common DP frame and bin grid but has its own histogram (and
optional sampling) panels. Colors are assigned per group, either from the
group labels (if they are valid color codes) or from a qualitative palette.

Draw PCA scatter + DP hist panels for multiple groups.
}
\details{
This function is a group-wise visualization wrapper around
\code{dp_hist_group()}. Internally, it:
\enumerate{
\item Extracts feature columns and group labels from \code{X}, depending on
\code{G}.
\item Applies (optionally DP) PCA to the pooled data via \code{dp_pca()},
and constructs a common DP frame and bin grid via
\code{dp_hist_group()}.
\item Builds a group-colored PCA scatter plot on the shared frame.
\item Aggregates per-group DP histograms (and optionally samples) into
panel layouts showing:
\itemize{
\item all-group histograms/samples (combined across groups),
\item per-group histograms/samples arranged via patchwork.
}
\item Uses helper functions such as \code{theme_dp_base_dp()},
\code{add_title_dp()}, \code{make_hist_all_dp()},
\code{make_hist_single_dp()}, \code{make_sample_all_dp()},
and \code{make_sample_single_dp()} to construct consistent ggplot2
panels.
}

Group colors are chosen as follows: if the group labels themselves are valid
color codes (checked via an internal helper \code{.is_color_vec()}), they are
used directly. Otherwise, colors are drawn from \code{hcl.colors()} with a
qualitative palette (e.g., \code{"Dark3"}).
}
\seealso{
\code{\link{dp_score_plot}},
\code{\link{dp_hist_group}},
\code{\link{dp_pca}},
\code{\link{dp_frame}},
\code{\link{number_bins}},
\code{\link{sample_from_hist}}
}
