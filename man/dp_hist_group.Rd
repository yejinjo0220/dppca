% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dp_hist_group.R
\name{dp_hist_group}
\alias{dp_hist_group}
\title{Group-wise DP 2D Histograms on PCA Scores}
\usage{
dp_hist_group(
  X,
  G,
  center = TRUE,
  scale. = FALSE,
  dp_pca_flag = FALSE,
  cpp.option = FALSE,
  axes = c(1, 2),
  eps_total,
  delta_total,
  eps_ratio = NULL,
  delta_ratio = NULL,
  inflate = 0.1,
  q_frame = NULL,
  m_x = NULL,
  m_y = NULL,
  bin_method = c("J", "W"),
  mechanism = c("all", "none", "add", "sparse"),
  sampling = FALSE
)
}
\arguments{
\item{X}{A numeric matrix or data frame with \eqn{n} rows (observations) and
\eqn{p} columns (variables and possibly a group label column). PCA is
performed on the feature columns, and the first two PCs are used for
binning.}

\item{G}{Group labels. Either
\itemize{
\item a vector of length \code{n} giving the group for each row of
\code{X}, or
\item a single character string giving the name of a column in \code{X}
that contains the group labels.
}}

\item{center}{Logical; should the variables be centered before PCA?
Passed to \code{scale()}.}

\item{scale.}{Logical; should the variables be scaled to unit variance?
Passed to \code{scale()}.}

\item{dp_pca_flag}{Logical; if \code{TRUE}, apply differentially private PCA
using \code{dp_pca()} with part of the total privacy budget
\code{eps_total}, \code{delta_total}. If \code{FALSE}, use non-DP PCA.}

\item{cpp.option}{Logical; if \code{TRUE}, allow C++ implementations inside
DP mechanisms (e.g., \code{mech_tau_sph()}) when available.}

\item{axes}{Integer vector indicating which principal components to return
(e.g., \code{c(1, 2)} for the first two PCs). The maximum index in
\code{axes} must not exceed the number of variables \code{p}.}

\item{eps_total}{Total privacy budget \eqn{\varepsilon_{\text{total}}} to be
split among DP-PCA (optional), DP frame (\code{dp_frame()}), and group-wise
DP histograms.}

\item{delta_total}{Total privacy parameter \eqn{\delta_{\text{total}}} to be
split among the same components.}

\item{eps_ratio}{Optional numeric vector specifying the relative allocation
of \code{eps_total}. If \code{dp_pca_flag = TRUE}, this must have length 3
and corresponds to \code{(PCA, q, hist)}. If \code{dp_pca_flag = FALSE},
this must have length 2 and corresponds to \code{(q, hist)}. The vector is
normalized to sum to 1. If \code{NULL}, equal weights are used.}

\item{delta_ratio}{Optional numeric vector specifying the relative allocation
of \code{delta_total}, with the same conventions as \code{eps_ratio}. The
vector is normalized to sum to 1. If \code{NULL}, equal weights are used.}

\item{inflate}{Non-negative numeric value controlling how much to enlarge the
DP frame relative to the DP min--max interval obtained from
\code{dp_frame()}. A value of \code{inflate = 0.10} enlarges the interval
by 10\\%.}

\item{q_frame}{Optional symmetric quantile level in \eqn{(0,1)} passed to
\code{dp_frame()}. If \code{NULL}, extreme order statistics
\eqn{1/n} and \eqn{(n-1)/n} are used.}

\item{m_x}{Optional integer specifying the number of bins along the first PC
axis. If \code{NULL}, it is chosen via \code{number_bins()} based on the
pooled PCA scores.}

\item{m_y}{Optional integer specifying the number of bins along the second PC
axis. If \code{NULL}, it is chosen via \code{number_bins()}.}

\item{bin_method}{Character string specifying the heuristic used by
\code{number_bins()} when \code{m_x} and/or \code{m_y} are not supplied.
One of \code{"J"} (Jing) or \code{"W"} (Wasserman).}

\item{mechanism}{Character string indicating which histogram mechanism(s) to
compute for each group:
\itemize{
\item \code{"none"}: (not implemented here; only DP mechanisms are
computed).
\item \code{"add"}: Gaussian additive-noise DP histogram per group.
\item \code{"sparse"}: sparse Laplace-thresholded DP histogram per group.
\item \code{"all"}: compute both \code{"add"} and \code{"sparse"}.
}}

\item{sampling}{Logical; if \code{TRUE}, additionally generate synthetic
samples from each group's DP histogram(s) using \code{sample_from_hist()}
with \code{k = n_g}, where \code{n_g} is the group size.}
}
\value{
A list with components:
\itemize{
\item \code{pca}: A list containing
\itemize{
\item \code{X_pca}: \eqn{n \times 2} matrix of pooled PCA scores.
\item \code{loadings}: loading matrix from \code{dp_pca()}.
\item \code{eigvals}: selected eigenvalues.
\item \code{dp}: logical flag indicating whether DP-PCA was used.
}
\item \code{frame}: A list with \code{xlim} and \code{ylim} giving the
common DP plotting limits.
\item \code{breaks}: A list with \code{x} and \code{y} break vectors.
\item \code{eps}: A list with \code{total}, \code{pca}, \code{q},
and \code{hist} components indicating how \code{eps_total} was split.
\item \code{delta}: A list with \code{total}, \code{pca}, \code{q},
and \code{hist} components indicating how \code{delta_total} was split.
\item \code{groups}: A named list with one entry per group. For each group
\code{g}, the entry contains:
\itemize{
\item \code{n}: group size \code{n_g}.
\item \code{counts}: empirical bin counts.
\item \code{add}: (if requested) a list with \code{p
}
\description{
Constructs (optionally differentially private) 2D histograms on the first two
principal component scores, separately for each group. The function supports
differentially private PCA, a shared differentially private frame across
groups, and group-wise DP histogram mechanisms (Gaussian additive and sparse
Laplace thresholding).
}
\details{
The function first separates the feature matrix and group labels. PCA
(possibly DP) is applied to the pooled data to obtain common principal
component axes. A single DP frame \code{(xlim, ylim)} is then constructed on
the pooled scores using \code{dp_frame()}, ensuring that all groups share the
same plotting region and bin grid.

For each group, counts are computed on the common grid. Depending on
\code{mechanism}, Gaussian-perturbed and/or sparse Laplace-thresholded DP
histograms are constructed. Optionally, synthetic samples are drawn from
each group's DP histogram using \code{sample_from_hist()}.
}
